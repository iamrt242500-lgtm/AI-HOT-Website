<!DOCTYPE html>
<html>
<head>
    <title>SNS Article Click Test</title>
    <script src="api-client.js"></script>
    <style>
        :root {
            --color-primary: #2547f4;
            --color-primary-light: #4a9fff;
            --color-bg: #000000;
            --color-surface: #1a1a1a;
            --color-surface-light: #2a2a2a;
            --color-text: #ffffff;
            --color-text-secondary: #888888;
            --color-border: #333333;
            --color-accent: #4a9fff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--color-bg);
            color: var(--color-text);
            font-family: 'Space Grotesk', monospace;
            padding: 20px;
        }
        
        h1 {
            margin-bottom: 20px;
            color: var(--color-accent);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .card {
            background: var(--color-surface-light);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .card:hover {
            background: var(--color-surface);
            border-color: var(--color-accent);
            transform: translateY(-4px);
        }
        
        .card h3 {
            font-size: 14px;
            font-weight: bold;
            margin: 0;
            color: var(--color-text);
        }
        
        .card p {
            font-size: 12px;
            color: var(--color-text-secondary);
            line-height: 1.4;
            margin: 0;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--color-primary);
            border-radius: 12px;
            font-size: 11px;
            color: var(--color-text);
            width: fit-content;
            margin-top: 8px;
        }
        
        .timestamp {
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-top: 8px;
        }
        
        .icon {
            font-size: 24px;
        }
        
        .info {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª SNS Article Click-to-Detail Test</h1>
    
    <div class="info">
        <strong>ğŸ“ í…ŒìŠ¤íŠ¸ ë°©ë²•:</strong><br>
        ì•„ë˜ì˜ SNS ê²Œì‹œê¸€ì„ í´ë¦­í•˜ë©´ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•´ì•¼ í•©ë‹ˆë‹¤.<br>
        ê° ê²Œì‹œê¸€ì˜ URLì€ ì›ë³¸ ê³µì‹ í˜ì´ì§€ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.
    </div>

    <div class="grid" id="articles"></div>

    <script>
        async function loadArticles() {
            console.log('Loading SNS articles...');
            const articlesDiv = document.getElementById('articles');
            
            articlesDiv.innerHTML = '<p style="color: var(--color-text-secondary);">ë¡œë”© ì¤‘...</p>';

            try {
                const data = await newsAPI.getSNSArticles(1, 6);
                console.log('âœ… Data received:', data);

                if (!data.articles || data.articles.length === 0) {
                    articlesDiv.innerHTML = '<p style="color: #ff6b6b;">ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                // Render articles
                articlesDiv.innerHTML = data.articles.map(article => {
                    const relativeTime = formatRelativeTime(article.timestamp);
                    
                    return `
                        <div class="card" onclick="handleArticleClick(${JSON.stringify(article).replace(/"/g, '&quot;')})">
                            <div>
                                <span class="icon">${article.icon || 'ğŸ“±'}</span>
                                <h3>${article.source}</h3>
                            </div>
                            <p>${article.title}</p>
                            <div class="badge">${article.type}</div>
                            <div class="timestamp">
                                ğŸ“… ${relativeTime}<br>
                                ğŸ”— ${article.url ? 'ë§í¬ ìˆìŒ' : 'ë§í¬ ì—†ìŒ'}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('âŒ Error:', error);
                articlesDiv.innerHTML = `<p style="color: #ff6b6b;">ì˜¤ë¥˜: ${error.message}</p>`;
            }
        }

        function formatRelativeTime(timestamp) {
            try {
                const date = new Date(timestamp);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
                if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
                if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
                if (diffDays === 1) return 'ì–´ì œ';
                if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                
                return date.toLocaleDateString('ko-KR');
            } catch (error) {
                return 'ìµœê·¼';
            }
        }

        function handleArticleClick(article) {
            console.log('ğŸ“„ Clicked article:', article);
            console.log('ğŸ”— URL:', article.url);
            console.log('ğŸ“± Is SNS:', !!article.sourceId);
            
            if (article.url) {
                // Open the URL directly
                let url = article.url;
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'https://' + url;
                }
                console.log('ğŸŒ Opening URL:', url);
                window.open(url, '_blank');
            } else {
                alert(`ì›ë³¸ ê²Œì‹œê¸€ URL: ${article.source}`);
            }
        }

        // Auto-load on page load
        window.onload = loadArticles;
    </script>
</body>
</html>
